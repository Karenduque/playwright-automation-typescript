"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var options_1 = __importDefault(require("../options"));
var logger_1 = require("../logger");
var ErrorRate = /** @class */ (function () {
    function ErrorRate(options) {
        this.options = options;
    }
    ErrorRate.prototype.shouldSimulate = function (req, tape) {
        var globalErrorRate = typeof (this.options.errorRate) === 'number' ? this.options.errorRate : this.options.errorRate(req);
        var errorRate = tape && tape.meta.errorRate !== undefined ? tape.meta.errorRate : globalErrorRate;
        options_1.default.validateErrorRate(errorRate);
        var random = Math.random() * 100;
        return random < errorRate;
    };
    ErrorRate.prototype.simulate = function (req) {
        logger_1.logger.log.info("Simulating error for ".concat(req.url));
        return {
            status: 503,
            headers: { 'content-type': ['text/plain'] },
            body: Buffer.from("talkback - failure injection")
        };
    };
    return ErrorRate;
}());
exports.default = ErrorRate;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJyb3ItcmF0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9lcnJvci1yYXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsdURBQWtEO0FBR2xELG9DQUFnQztBQUVoQztJQUdFLG1CQUFZLE9BQWdCO1FBQzFCLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO0lBQ3hCLENBQUM7SUFFRCxrQ0FBYyxHQUFkLFVBQWUsR0FBTyxFQUFFLElBQVc7UUFDakMsSUFBTSxlQUFlLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFM0gsSUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQTtRQUVuRyxpQkFBYyxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBRTNDLElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUE7UUFDbEMsT0FBTyxNQUFNLEdBQUcsU0FBUyxDQUFBO0lBQzNCLENBQUM7SUFFRCw0QkFBUSxHQUFSLFVBQVMsR0FBUTtRQUNmLGVBQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLCtCQUF3QixHQUFHLENBQUMsR0FBRyxDQUFFLENBQUMsQ0FBQTtRQUNsRCxPQUFPO1lBQ0wsTUFBTSxFQUFFLEdBQUc7WUFDWCxPQUFPLEVBQUUsRUFBQyxjQUFjLEVBQUUsQ0FBQyxZQUFZLENBQUMsRUFBQztZQUN6QyxJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQztTQUMzQyxDQUFBO0lBQ1YsQ0FBQztJQUNILGdCQUFDO0FBQUQsQ0FBQyxBQTFCRCxJQTBCQyJ9